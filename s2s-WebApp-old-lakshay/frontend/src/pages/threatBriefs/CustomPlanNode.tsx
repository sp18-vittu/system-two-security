import React from 'react'
import CustomHandle from './CustomHandle'
import { Position } from 'react-flow-renderer'
import Tooltip, { TooltipProps, tooltipClasses } from '@mui/material/Tooltip'
import { styled } from '@mui/material/styles'

const BootstrapTooltip = styled(({ className, ...props }: TooltipProps) => (
  <Tooltip {...props} arrow classes={{ popper: className }} />
))(() => ({
  [`& .${tooltipClasses.arrow}`]: {
    color: '#f1f1f1',
  },
  [`& .${tooltipClasses.tooltip}`]: {
    backgroundColor: '#f1f1f1',
    color: '#1D2939',
    fontWieght: 40,
    fontSize: 12,
  },
}))

const CustomPlanNode = ({ data }: any) => {
  const { label, count } = data
  const threatcard = sessionStorage.getItem('threat')
  const threatcarddata = JSON.parse(threatcard as any)

  return (
    <>
      <foreignObject width={180} height={200} x={-150} y={-40}>
        <div className='flex w-64 p-1 flex-col justify-between items-start gap-1 rounded-lg bg-[#1D2939] shadow-md cursor-default'>
          <div className=''>
            <div className='flex items-center gap-1 w-full'>
              <div className='p-1 py-[-10] rounded-full '>
                <svg
                  xmlns='http://www.w3.org/2000/svg'
                  width='28'
                  height='28'
                  viewBox='0 0 16 6'
                  fill='none'
                >
                  <path
                    d='M15.5653 2.94071L14.0713 2.21338V1.78004L16 2.74738V3.14271L14.0713 4.10138V3.67738L15.5653 2.94071ZM11.9673 4.16804H11.3267V0.628043H11.9673V2.70538H12.0353L12.8887 1.71804L13.3707 1.92471L12.5507 2.80204L13.5193 4.00804L12.9273 4.21538L11.9673 2.88471V4.16804ZM10.2493 4.16671V2.78804C10.2509 2.6944 10.2451 2.60078 10.232 2.50804C10.2223 2.4472 10.202 2.38854 10.172 2.33471C10.0967 2.20004 9.96667 2.13204 9.77867 2.13204C9.67128 2.1288 9.56504 2.15484 9.47133 2.20738C9.38509 2.25748 9.318 2.33489 9.28067 2.42738C9.25729 2.48345 9.24159 2.54243 9.234 2.60271C9.226 2.68938 9.22133 2.77738 9.22267 2.86604V4.16604H8.582V1.75671H9.22267L9.224 2.08004C9.34733 1.94671 9.47267 1.84804 9.60133 1.78871C9.72933 1.72938 9.88 1.69938 10.05 1.69938C10.2407 1.69938 10.4013 1.73804 10.5307 1.81738C10.6113 1.86532 10.681 1.92949 10.7355 2.0058C10.7901 2.08211 10.8281 2.16892 10.8473 2.26071C10.8707 2.35856 10.8828 2.45877 10.8833 2.55938C10.8847 2.62604 10.886 2.70604 10.886 2.79804V4.16671H10.2493ZM7.506 4.16804L7.50467 3.84471C7.40005 3.96623 7.27192 4.06533 7.128 4.13604C6.98653 4.1983 6.8332 4.22901 6.67867 4.22604C6.48867 4.22604 6.32933 4.18804 6.19867 4.11271C6.06796 4.03714 5.96775 3.9183 5.91533 3.77671C5.89902 3.74114 5.88694 3.70377 5.87933 3.66538C5.86968 3.62157 5.86233 3.57729 5.85733 3.53271C5.84991 3.47567 5.84612 3.41823 5.846 3.36071C5.84399 3.28184 5.84288 3.20294 5.84267 3.12404V1.75338H6.48V3.13338C6.478 3.22738 6.484 3.32138 6.49733 3.41338C6.50733 3.47471 6.52733 3.53338 6.55733 3.58671C6.63267 3.72271 6.76267 3.79071 6.95067 3.79071C7.19067 3.79071 7.35467 3.69071 7.444 3.49138C7.46733 3.43671 7.484 3.37938 7.49333 3.32004C7.50467 3.23071 7.50933 3.14071 7.508 3.05138V1.75138H8.14467V4.16738L7.506 4.16804ZM4.78933 0.626709H5.426V4.16671H4.78933V0.626709ZM3.83933 2.93338C3.83933 2.66938 3.786 2.46138 3.67933 2.30871C3.63212 2.23609 3.56705 2.1768 3.49036 2.13653C3.41367 2.09626 3.32792 2.07635 3.24133 2.07871C3.14991 2.07659 3.05946 2.0979 2.97859 2.14061C2.89772 2.18331 2.82913 2.246 2.77933 2.32271C2.66533 2.48604 2.60867 2.70538 2.61067 2.98271C2.61067 3.25271 2.66667 3.46471 2.77733 3.62071C2.82807 3.69514 2.89692 3.75543 2.9774 3.7959C3.05787 3.83638 3.14733 3.8557 3.23733 3.85204C3.34098 3.85569 3.44279 3.82395 3.526 3.76204C3.60381 3.70132 3.66693 3.62385 3.71067 3.53538C3.758 3.44204 3.79133 3.34071 3.80867 3.23671C3.82867 3.13604 3.83733 3.03671 3.83933 2.93338ZM4.51267 2.90938C4.51467 3.08671 4.486 3.26404 4.42667 3.43338C4.372 3.58671 4.29067 3.72738 4.184 3.85071C3.97733 4.09138 3.67467 4.22871 3.35733 4.22604C3.28735 4.22639 3.21748 4.22014 3.14867 4.20738C3.08479 4.19432 3.02307 4.17232 2.96533 4.14204C2.90376 4.10936 2.84625 4.06953 2.794 4.02338C2.73048 3.96859 2.6714 3.90884 2.61733 3.84471V5.37338H1.998V1.75671H2.618L2.62067 2.10938C2.73333 1.96804 2.856 1.86404 2.98733 1.79738C3.11867 1.73071 3.27133 1.69738 3.446 1.69938C3.59124 1.69673 3.73534 1.72557 3.86837 1.78392C4.00141 1.84227 4.12023 1.92873 4.21667 2.03738C4.31533 2.14804 4.38933 2.27804 4.43667 2.41804C4.49 2.57538 4.516 2.74138 4.51267 2.90938ZM1.70667 3.50271C1.70812 3.60477 1.68479 3.70566 1.63867 3.79671C1.59396 3.88645 1.52972 3.96504 1.45067 4.02671C1.364 4.09338 1.26733 4.14204 1.164 4.17338C1.04613 4.20976 0.923353 4.22775 0.8 4.22671C0.655867 4.22843 0.512422 4.20658 0.375333 4.16204C0.23928 4.11219 0.112445 4.0401 0 3.94871L0.208 3.61204C0.308 3.69604 0.397333 3.75671 0.478 3.79538C0.554667 3.83338 0.638 3.85338 0.723333 3.85338C0.813176 3.85771 0.901536 3.82928 0.972 3.77338C1.00302 3.74718 1.02757 3.71418 1.04376 3.67695C1.05995 3.63972 1.06733 3.59926 1.06533 3.55871C1.06573 3.48059 1.03724 3.40509 0.985333 3.34671C0.947636 3.30429 0.905881 3.26567 0.860667 3.23138C0.793307 3.1784 0.724847 3.12683 0.655333 3.07671C0.591693 3.03166 0.529228 2.98498 0.468 2.93671C0.407901 2.88979 0.351716 2.83807 0.3 2.78204C0.250526 2.72769 0.21002 2.6658 0.18 2.59871C0.148139 2.52583 0.132445 2.4469 0.134 2.36738C0.132933 2.2728 0.154415 2.17933 0.196667 2.09471C0.23738 2.01336 0.295404 1.94191 0.366667 1.88538C0.444422 1.82489 0.532519 1.77904 0.626667 1.75004C0.733333 1.71671 0.844667 1.70071 0.956 1.70204C1.07867 1.70204 1.20133 1.71938 1.31933 1.75271C1.43533 1.78604 1.54467 1.83471 1.64467 1.89871L1.45667 2.20138C1.3388 2.11559 1.1971 2.06875 1.05133 2.06738C0.97386 2.06452 0.897783 2.08855 0.836 2.13538C0.809511 2.1547 0.788054 2.18011 0.773435 2.20947C0.758817 2.23882 0.751466 2.27126 0.752 2.30404C0.752 2.36938 0.779333 2.43271 0.827333 2.47738C0.876667 2.52938 0.962667 2.60138 1.084 2.69404C1.20733 2.78471 1.308 2.86271 1.38867 2.93071C1.458 2.98738 1.52333 3.05204 1.57933 3.12138C1.62267 3.17471 1.656 3.23671 1.676 3.30338C1.69868 3.3673 1.70909 3.43493 1.70667 3.50271Z'
                    fill='white'
                  />
                </svg>
              </div>
              <div className='flex-1'>
                <div className={'flex justify-between w-full nod_text'}>
                  <BootstrapTooltip title={label ? label : threatcarddata?.name}>
                    <span className='text-[14px]   whitespace-normal overflow-hidden text-ellipsis line-clamp-2 nod_text cursor-pointer'>
                      {label ? label : threatcarddata?.name}
                    </span>
                  </BootstrapTooltip>
                </div>
              </div>
            </div>
            <div className='flex items-center w-full mt[-16px]'>
              <div className='truncate w-48 pl-9 mt-[-4px] text-gray-400 '>
                <span className='text-[10px] '>{'Initialized'}</span>
              </div>
              {count > 0 && (
                <div className='w-1/2 flex items-center justify-end space-x-1'>
                  <p className='text-[10px] text-gray-400'>
                    {count > 1 ? `${count} Sub Queries` : `${count} Sub Querie`}{' '}
                  </p>
                  <svg
                    xmlns='http://www.w3.org/2000/svg'
                    width='12'
                    height='12'
                    viewBox='0 0 12 12'
                    fill='none'
                  >
                    <path
                      d='M6.46045 1.64941L6.46045 3.94791C6.46038 4.32283 6.35725 4.69293 6.1587 5.03082C5.96014 5.36872 5.67125 5.66574 5.31339 5.89991L4.55195 6.39891C4.1941 6.63309 3.9052 6.93011 3.70664 7.268C3.50809 7.60589 3.40496 7.976 3.40489 8.35091L3.40489 10.6494M3.40489 10.6494L4.34934 9.14941M3.40489 10.6494L2.46045 9.14941M9.516 10.6494L9.516 8.11041C9.51589 7.81061 9.43339 7.51466 9.27461 7.24446C9.11584 6.97426 8.88484 6.73672 8.59873 6.54941L7.37712 5.74991C7.09103 5.56251 6.86011 5.32487 6.70144 5.05458C6.54276 4.78429 6.4604 4.48826 6.46045 4.18841L6.46045 3.14941M9.516 10.6494L10.4604 9.14941M9.516 10.6494L8.57156 9.14941'
                      stroke='#EE7103'
                      stroke-linecap='round'
                      stroke-linejoin='round'
                    />
                  </svg>
                </div>
              )}
            </div>
          </div>
        </div>
      </foreignObject>
      <CustomHandle type='source' position={Position.Right} />
      <CustomHandle type='target' position={Position.Left} />
    </>
  )
}

export default CustomPlanNode
